from flask import Flask, render_template, request
from auditor.fetcher import fetch_site
from auditor.analyzer import analyze_headers  # y analyze_html si la tienes

app = Flask(__name__)

@app.route("/analizar", methods=["GET", "POST"])
def index():
    if request.method == "POST":
        url = request.form.get("url")
        html, headers = fetch_site(url)
        if html is None:
            issues = ["No se pudo acceder a la URL."]
        else:
            issues = []
            # Si tienes analyze_html, Ãºsalo aquÃ­:
            # issues += analyze_html(html)
            issues += analyze_headers(headers)

        return render_template("report.html", url=url, issues=issues)
    return render_template("index.html")

if __name__ == "__main__":
    app.run(debug=True)
from flask import Flask, render_template, request
import re
import requests

app = Flask(__name__)

@app.route('/', methods=['GET'])
def index():
    return render_template('index.html')

@app.route('/analizar', methods=['POST'])
def analizar():
    url = request.form['url']
    resultado = analizar_url(url)
    return render_template('index.html', resultado=resultado)

def analizar_url(url):
    # Normalizar URL
    url = url.strip()

    # 1ï¸âƒ£ Verificar formato vÃ¡lido
    regex = re.compile(
        r'^(?:http|ftp)s?://' # http:// o https://
        r'(?:[\w-]+\.)+[a-z]{2,6}' # dominio
        r'(?:[/?#]\S*)?$', re.IGNORECASE)
    if not re.match(regex, url):
        return "âŒ La URL no tiene un formato vÃ¡lido."

    # 2ï¸âƒ£ Comprobar si responde
    try:
        response = requests.get(url, timeout=5)
        status = response.status_code
    except Exception:
        return "âš ï¸ No se ha podido acceder a la URL."

    # 3ï¸âƒ£ HeurÃ­sticas simples de phishing / legitimidad
    indicadores_sospechosos = [
        "login", "verify", "update", "secure", "account", "bank", "free", "gift", "win"
    ]
    puntuacion = 0

    # Subdominios excesivos â†’ sospechoso
    if url.count('.') > 3:
        puntuacion += 1

    # Palabras sospechosas
    for palabra in indicadores_sospechosos:
        if palabra in url.lower():
            puntuacion += 1

    # Si contiene direcciÃ³n IP â†’ sospechoso
    if re.match(r"http[s]?://\d+\.\d+\.\d+\.\d+", url):
        puntuacion += 2

    # Resultado
    if puntuacion == 0 and status == 200:
        return "âœ… La URL parece legÃ­tima."
    elif puntuacion < 3:
        return "âš ï¸ La URL podrÃ­a ser sospechosa. Revisa con precauciÃ³n."
    else:
        return "ðŸš¨ La URL parece fraudulenta o peligrosa."

if __name__ == '__main__':
    app.run(debug=True)
